<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zach & Sydney Boyer Wedding</title>
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, rgba(242, 244, 241, 0.8) 0%, rgba(232, 237, 231, 0.8) 100%), 
                  url('https://via.placeholder.com/1920x1080?text=Wedding+Background') no-repeat center center fixed;
      background-size: cover;
      color: #2e3d29;
      min-height: 100vh;
      position: relative;
    }

    /* Top right admin button */
    .top-right {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .top-right button {
      background-color: #556b2f;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(85, 107, 47, 0.3);
    }

    .top-right button:hover {
      background-color: #6b7a43;
      transform: translateY(-2px);
    }

    /* Main container */
    .main-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    /* Tab system */
    .tab-container {
      width: 100%;
      max-width: 1200px;
    }

    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .tab-btn {
      background-color: #8da88d;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(141, 168, 141, 0.3);
    }

    .tab-btn:hover {
      background-color: #6b7a43;
      transform: translateY(-2px);
    }

    .tab-btn.active {
      background-color: #556b2f;
      box-shadow: 0 4px 12px rgba(85, 107, 47, 0.4);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Upload section */
    .upload-section {
      background: white;
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(85, 107, 47, 0.15);
      max-width: 500px;
      margin: 0 auto;
      text-align: center;
    }

    .upload-section h1 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #556b2f;
    }

    .upload-section .subtitle {
      font-size: 1.1rem;
      margin-bottom: 30px;
      color: #6b7a43;
    }

    .upload-area {
      border: 3px dashed #8da88d;
      border-radius: 12px;
      padding: 40px 20px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8faf8;
    }

    .upload-area:hover, .upload-area.dragover {
      border-color: #556b2f;
      background: #f0f4f0;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 3rem;
      color: #8da88d;
      margin-bottom: 15px;
    }

    .file-input {
      display: none;
    }

    .upload-btn, .main-btn {
      background-color: #8da88d;
      color: white;
      border: none;
      padding: 14px 30px;
      font-size: 1.1rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(141, 168, 141, 0.3);
      margin: 5px;
    }

    .upload-btn:hover, .main-btn:hover {
      background-color: #6b7a43;
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .confirmation {
      margin-top: 20px;
      padding: 15px;
      background: #d4edda;
      color: #155724;
      border-radius: 8px;
      display: none;
      font-weight: 600;
    }

    .error-message {
      margin-top: 20px;
      padding: 15px;
      background: #f8d7da;
      color: #721c24;
      border-radius: 8px;
      display: none;
      font-weight: 600;
    }

    /* Gallery section */
    .gallery-section {
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
    }

    .gallery-section h2 {
      font-size: 2.5rem;
      color: #556b2f;
      margin-bottom: 30px;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .photo-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(85, 107, 47, 0.2);
    }

    .photo-item:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(85, 107, 47, 0.3);
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .no-photos {
      grid-column: 1 / -1;
      padding: 40px;
      color: #6b7a43;
      font-size: 1.2rem;
    }

    .loading {
      grid-column: 1 / -1;
      padding: 40px;
      color: #6b7a43;
      font-size: 1.2rem;
    }

    /* Admin section */
    .admin-section {
      max-width: 500px;
      margin: 0 auto;
    }

    .admin-login {
      background: white;
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(85, 107, 47, 0.15);
      text-align: center;
    }

    .admin-login h2 {
      color: #556b2f;
      margin-bottom: 30px;
      font-size: 2rem;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #556b2f;
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e8ede7;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #8da88d;
    }

    .admin-panel {
      display: none;
      background: white;
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(85, 107, 47, 0.15);
    }

    .admin-panel.active {
      display: block;
    }

    .admin-panel h2 {
      color: #556b2f;
      margin-bottom: 30px;
      text-align: center;
    }

    .export-section {
      text-align: center;
      padding: 20px;
      background: #f8faf8;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    .export-btn {
      background-color: #28a745;
      padding: 15px 30px;
      font-size: 1.1rem;
    }

    .export-btn:hover {
      background-color: #218838;
    }

    .delete-all-btn {
      background-color: #dc3545;
      margin-left: 10px;
    }

    .delete-all-btn:hover {
      background-color: #c82333;
    }

    .admin-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .admin-photo-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(85, 107, 47, 0.2);
    }

    .admin-photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .delete-photo-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #dc3545;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      position: relative;
      margin: auto;
      padding: 20px;
      width: 90%;
      max-width: 800px;
      top: 50%;
      transform: translateY(-50%);
      text-align: center;
    }

    .modal img {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 8px;
    }

    .close {
      position: absolute;
      top: 20px;
      right: 35px;
      color: white;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Progress bar */
    .progress-container {
      width: 100%;
      background-color: #e8ede7;
      border-radius: 10px;
      margin: 10px 0;
      display: none;
    }

    .progress-bar {
      width: 0%;
      height: 20px;
      background-color: #8da88d;
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .upload-section h1 {
        font-size: 2rem;
      }
      
      .tab-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="top-right">
    <button onclick="switchTab('admin')">Admin</button>
  </div>

  <div class="main-container">
    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-btn active" onclick="switchTab('upload')">Upload Photos</button>
        <button class="tab-btn" onclick="switchTab('gallery')">View Gallery</button>
        <button class="tab-btn" onclick="switchTab('admin')">Admin</button>
      </div>

      <!-- Upload Tab -->
      <div id="upload" class="tab-content active">
        <div class="upload-section">
          <h1>Zach & Sydney Boyer Wedding</h1>
          <p class="subtitle">Please upload your favorite wedding photos</p>
          
          <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">📷</div>
            <p>Click here or drag and drop photos</p>
            <p style="font-size: 0.9rem; color: #8da88d; margin-top: 10px;">
              Supports JPG, PNG, GIF up to 10MB each
            </p>
          </div>
          
          <input type="file" id="fileInput" class="file-input" multiple accept="image/*">
          <button id="uploadBtn" class="upload-btn" onclick="document.getElementById('fileInput').click()">
            Choose Photos
          </button>
          
          <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
          </div>
          
          <div id="confirmation" class="confirmation">
            ✅ Photos uploaded successfully!
          </div>
          
          <div id="uploadError" class="error-message">
            ❌ Upload failed. Please try again.
          </div>
        </div>
      </div>

      <!-- Gallery Tab -->
      <div id="gallery" class="tab-content">
        <div class="gallery-section">
          <h2>Wedding Photo Gallery</h2>
          <div id="photoGallery" class="gallery">
            <div class="loading">Loading photos...</div>
          </div>
        </div>
      </div>

      <!-- Admin Tab -->
      <div id="admin" class="tab-content">
        <div class="admin-section">
          <div id="adminLogin" class="admin-login">
            <h2>Admin Login</h2>
            <div class="form-group">
              <label for="username">Username:</label>
              <input type="text" id="username" required>
            </div>
            <div class="form-group">
              <label for="password">Password:</label>
              <input type="password" id="password" required>
            </div>
            <button class="main-btn" onclick="adminLogin()">Login</button>
            <div id="loginError" class="error-message">
              Invalid username or password
            </div>
          </div>

          <div id="adminPanel" class="admin-panel">
            <h2>Admin Panel</h2>
            <div class="export-section">
              <p>Export all photos to download or delete photos</p>
              <button class="export-btn main-btn" onclick="exportAllPhotos()">
                📥 Download All Photos
              </button>
              <button class="delete-all-btn main-btn" onclick="deleteAllPhotos()">
                🗑️ Delete All Photos
              </button>
            </div>
            
            <h3 style="color: #556b2f; margin-bottom: 20px;">Manage Photos</h3>
            <div id="adminGallery" class="admin-gallery">
              <div class="loading">Loading photos...</div>
            </div>
            
            <button class="main-btn" onclick="adminLogout()" style="margin-top: 30px;">
              Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for viewing photos -->
  <div id="photoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="modalImage" src="" alt="Photo">
    </div>
  </div>

  <script>
    // Global variables
    let currentTab = 'upload';
    let isAdminLoggedIn = false;
    let adminCredentials = null;

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      loadGallery();
    });

    // Tab switching
    function switchTab(tabName) {
      // Hide all tabs
      const tabs = document.querySelectorAll('.tab-content');
      const buttons = document.querySelectorAll('.tab-btn');
      
      tabs.forEach(tab => tab.classList.remove('active'));
      buttons.forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      
      // Find and activate the correct button
      const targetBtn = Array.from(buttons).find(btn => 
        btn.textContent.toLowerCase().includes(tabName) || 
        (tabName === 'admin' && btn.onclick.toString().includes('admin'))
      );
      if (targetBtn) targetBtn.classList.add('active');
      
      currentTab = tabName;
      
      if (tabName === 'gallery') {
        loadGallery();
      } else if (tabName === 'admin') {
        if (isAdminLoggedIn) {
          showAdminPanel();
        } else {
          showAdminLogin();
        }
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      const fileInput = document.getElementById('fileInput');
      const uploadArea = document.querySelector('.upload-area');

      // File input change
      fileInput.addEventListener('change', handleFileSelect);

      // Drag and drop
      uploadArea.addEventListener('dragover', handleDragOver);
      uploadArea.addEventListener('dragleave', handleDragLeave);
      uploadArea.addEventListener('drop', handleDrop);

      // Modal close on click outside
      document.getElementById('photoModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal();
        }
      });

      // Enter key for admin login
      document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          adminLogin();
        }
      });
    }

    // File handling
    function handleFileSelect(event) {
      const files = event.target.files;
      if (files.length > 0) {
        uploadFiles(files);
      }
    }

    function handleDragOver(event) {
      event.preventDefault();
      event.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(event) {
      event.currentTarget.classList.remove('dragover');
    }

    function handleDrop(event) {
      event.preventDefault();
      event.currentTarget.classList.remove('dragover');
      const files = event.dataTransfer.files;
      uploadFiles(files);
    }

    async function uploadFiles(files, attempt = 1, maxAttempts = 3) {
      const maxSize = 10 * 1024 * 1024; // 10MB
      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
      
      const validFiles = Array.from(files).filter(file => {
        if (!allowedTypes.includes(file.type)) {
          showError(`${file.name} is not a supported image format. Use JPG, PNG, or GIF.`);
          return false;
        }
        
        if (file.size > maxSize) {
          showError(`${file.name} is too large. Maximum size is 10MB.`);
          return false;
        }
        
        return true;
      });

      if (validFiles.length === 0) {
        showError('No valid files selected. Please choose JPG, PNG, or GIF files under 10MB.');
        return;
      }

      const uploadBtn = document.getElementById('uploadBtn');
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Uploading...';
      progressContainer.style.display = 'block';

      try {
        for (let i = 0; i < validFiles.length; i++) {
          const file = validFiles[i];
          const formData = new FormData();
          formData.append('photo', file);

          const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            const errorText = await response.text().catch(() => 'Unknown error');
            if (response.status === 404) {
              throw new Error(`Upload endpoint not found. Please check the server configuration.`);
            } else if (response.status === 401) {
              throw new Error(`Unauthorized. Authentication may be required for uploads.`);
            } else if (response.status >= 500) {
              throw new Error(`Server error (${response.status}) while uploading ${file.name}.`);
            } else {
              throw new Error(`Failed to upload ${file.name}: ${errorText}`);
            }
          }

          // Update progress
          const progress = ((i + 1) / validFiles.length) * 100;
          progressBar.style.width = progress + '%';
        }

        showConfirmation();
        document.getElementById('fileInput').value = ''; // Clear file input
        
      } catch (error) {
        console.error('Upload error:', {
          message: error.message,
          attempt,
          status: error.status || 'N/A',
          stack: error.stack
        });
        
        if (attempt < maxAttempts && !error.message.includes('endpoint not found') && !error.message.includes('Unauthorized')) {
          console.log(`Retrying upload (attempt ${attempt + 1}/${maxAttempts})...`);
          await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
          return uploadFiles(files, attempt + 1, maxAttempts);
        }
        
        let errorMessage = 'Upload failed. Please try again.';
        if (error.message.includes('endpoint not found')) {
          errorMessage = 'Upload service unavailable. Contact the site administrator.';
        } else if (error.message.includes('Unauthorized')) {
          errorMessage = 'Authentication required to upload photos. Please contact support.';
        } else if (error.message.includes('Server error')) {
          errorMessage = 'Server issue. Please try again later or contact support.';
        }
        
        showError(errorMessage);
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Choose Photos';
        setTimeout(() => {
          progressContainer.style.display = 'none';
          progressBar.style.width = '0%';
        }, 2000);
      }
    }

    function showConfirmation() {
      const confirmation = document.getElementById('confirmation');
      const error = document.getElementById('uploadError');
      error.style.display = 'none';
      confirmation.style.display = 'block';
      setTimeout(() => {
        confirmation.style.display = 'none';
      }, 4000);
    }

    function showError(message) {
      const error = document.getElementById('uploadError');
      const confirmation = document.getElementById('confirmation');
      confirmation.style.display = 'none';
      error.textContent = message;
      error.style.display = 'block';
      setTimeout(() => {
        error.style.display = 'none';
      }, 5000);
    }

    // Gallery functions
    async function loadGallery(attempt = 1, maxAttempts = 3) {
      const gallery = document.getElementById('photoGallery');
      
      try {
        const response = await fetch('/api/gallery');
        if (!response.ok) {
          const errorText = await response.text().catch(() => 'Unknown error');
          if (response.status === 404) {
            throw new Error('Gallery endpoint not found. Please check the server configuration.');
          } else if (response.status === 401) {
            throw new Error('Unauthorized access. Authentication may be required.');
          } else if (response.status >= 500) {
            throw new Error(`Server error (${response.status}). Please try again later.`);
          } else {
            throw new Error(`Failed to load gallery: ${errorText}`);
          }
        }
        
        const photos = await response.json();
        displayGallery(photos);
        
      } catch (error) {
        console.error('Error loading gallery:', {
          message: error.message,
          attempt,
          status: error.status || 'N/A',
          stack: error.stack
        });
        
        if (attempt < maxAttempts) {
          console.log(`Retrying gallery load (attempt ${attempt + 1}/${maxAttempts})...`);
          await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
          return loadGallery(attempt + 1, maxAttempts);
        }
        
        let errorMessage = 'Error loading photos. Please try refreshing the page.';
        if (error.message.includes('endpoint not found')) {
          errorMessage = 'Gallery service unavailable. Contact the site administrator.';
        } else if (error.message.includes('Unauthorized')) {
          errorMessage = 'Authentication required to view gallery. Please log in.';
        } else if (error.message.includes('Server error')) {
          errorMessage = 'Server issue. Please try again later or contact support.';
        }
        
        gallery.innerHTML = `<div class="no-photos">${errorMessage}</div>`;
      }
    }

    function displayGallery(photos) {
      const gallery = document.getElementById('photoGallery');
      
      if (photos.length === 0) {
        gallery.innerHTML = '<div class="no-photos">No photos uploaded yet. Be the first to share your memories!</div>';
        return;
      }
      
      gallery.innerHTML = photos.map(photo => `
        <div class="photo-item" onclick="openModal('/api/photo/${photo}')">
          <img src="/api/photo/${photo}" alt="Wedding photo" loading="lazy">
        </div>
      `).join('');
    }

    function openModal(imageSrc) {
      document.getElementById('modalImage').src = imageSrc;
      document.getElementById('photoModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('photoModal').style.display = 'none';
    }

    // Admin functions
    async function adminLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errorMsg = document.getElementById('loginError');
      
      // Hardcoded credentials for testing (NOT SECURE for production)
      const validUsername = 'admin';
      const validPassword = 'wedding2025';
      
      if (username === validUsername && password === validPassword) {
        isAdminLoggedIn = true;
        adminCredentials = btoa(username + ':' + password); // Keep for compatibility with existing server calls
        showAdminPanel();
        errorMsg.style.display = 'none';
      } else {
        errorMsg.style.display = 'block';
      }
    }

    function showAdminLogin() {
      document.getElementById('adminLogin').style.display = 'block';
      document.getElementById('adminPanel').classList.remove('active');
    }

    async function showAdminPanel() {
      document.getElementById('adminLogin').style.display = 'none';
      document.getElementById('adminPanel').classList.add('active');
      await loadAdminGallery();
    }

    async function loadAdminGallery() {
      const adminGallery = document.getElementById('adminGallery');
      
      try {
        const response = await fetch('/api/admin/gallery', {
          headers: {
            'Authorization': 'Basic ' + adminCredentials
          }
        });
        
        if (!response.ok) throw new Error('Failed to load admin gallery');
        
        const photos = await response.json();
        displayAdminGallery(photos);
        
      } catch (error) {
        console.error('Error loading admin gallery:', error);
        adminGallery.innerHTML = '<div class="no-photos">Error loading photos for management.</div>';
      }
    }

    function displayAdminGallery(photos) {
      const adminGallery = document.getElementById('adminGallery');
      
      if (photos.length === 0) {
        adminGallery.innerHTML = '<div class="no-photos">No photos to manage</div>';
        return;
      }
      
      adminGallery.innerHTML = photos.map(photo => `
        <div class="admin-photo-item">
          <img src="/api/photo/${photo}" alt="Wedding photo">
          <button class="delete-photo-btn" onclick="deletePhoto('${photo}')" title="Delete photo">×</button>
        </div>
      `).join('');
    }

    async function deletePhoto(filename) {
      if (!confirm('Are you sure you want to delete this photo?')) return;
      
      try {
        const response = await fetch(`/api/admin/delete/${filename}`, {
          method: 'DELETE',
          headers: {
            'Authorization': 'Basic ' + adminCredentials
          }
        });

        if (response.ok) {
          await loadAdminGallery();
          if (currentTab === 'gallery') {
            await loadGallery();
          }
        } else {
          alert('Failed to delete photo');
        }
      } catch (error) {
        console.error('Delete error:', error);
        alert('Error deleting photo');
      }
    }

    async function deleteAllPhotos() {
      if (!confirm('Are you sure you want to delete ALL photos? This cannot be undone.')) return;
      
      try {
        const response = await fetch('/api/admin/delete-all', {
          method: 'DELETE',
          headers: {
            'Authorization': 'Basic ' + adminCredentials
          }
        });

        if (response.ok) {
          await loadAdminGallery();
          if (currentTab === 'gallery') {
            await loadGallery();
          }
          alert('All photos have been deleted.');
        } else {
          alert('Failed to delete photos');
        }
      } catch (error) {
        console.error('Delete all error:', error);
        alert('Error deleting photos');
      }
    }

    async function exportAllPhotos() {
      try {
        const response = await fetch('/api/admin/export', {
          headers: {
            'Authorization': 'Basic ' + adminCredentials
          }
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `wedding-photos-${new Date().toISOString().split('T')[0]}.zip`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        } else {
          alert('Failed to export photos');
        }
      } catch (error) {
        console.error('Export error:', error);
        alert('Error exporting photos');
      }
    }

    function adminLogout() {
      isAdminLoggedIn = false;
      adminCredentials = null;
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      showAdminLogin();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>
